# Topic Mapping Interface - API doc

The Topic Mapping Interface script and stylesheet bundles are located in [`app/dist`](../app/dist).

The stylesheet contains the styles of all page modules as well as default styles for the page overall.
Check [this section](#styles) for more details.

The script sets up `tMap`, the top level library object for interacting with the Topic Map interface and its modules.

- [Page Layout Management](#page-manager)
- [Data Management](#data-manager)

## Page Manager

The page manager sets a grid on the HTML page that will automatically position and size containers for the modules.

It is instantiated as follow:
```javascript
let PM = tMap.PageManager(container, layout, controls, header, footer, minWidth, minHeight);
```
- `container` is a string selector for the DOM element that will contain all modules, e.g. `'div#app'`. It defaults to `'body'`.
- `layout` is a string specifying the desired page layout. It defaults to `'A'` (one panel taking the whole space).
- `controls` is a string specifying the desired page controls and there position. It defaults to `''` (no controls).
- `header` and `footer` are the string selectors for the DOM element acting as page header and footer. Their height will be deducted when computing the page size. They both default to `''` (no element).
- `minWidth` and `minHeight` are integers used to set the page minimum size. They both default to `600`. 

For more detail about the layout and controls parameters, check [this page](./PageLayouts.md).

The Page Manager instance created, `PM`, is an object listing the selectors and sizes of each panels generated. For example, if you choose to generate layout with 3 panels and 2 controls, `PM` will contain 5 attributes: `panel1`, `panel2`, `panel3`, `control1`, and `control2`. Each of these attributes will have 3 attributes of their own: `c` the string selector for the container created, `w` the width available for it, and `h` the height.
```javascript
PM.panel1.c // --> the selector for panel1 container, typically 'div#panel1'
PM.panel1.w // --> the width available for panel1, e.g. 500
PM.panel1.h // --> the height available for panel1, e.g. 300
```

### Page Responsivity

The Page Manager instance also has a `watch` function available:
```javascript
PM.watch({
    panel: module
})
```

This provides a map between the panels' names and the interface modules. During window resizing, Page Manager will recompute the panels' sizes and automatically updates the modules.

## Data Manager

The data manager facilitates the loading and interaction with the data files generated by the Topic Mapping Pipeline.

It is instantiated as follow:
```javascript
let DM = tMap.DataManager();
```

You can then access the data management features from `DM`.

### Processing Data

#### `DataManager.loadDataFromUrls(urls)`

Loads data from the urls provided. The urls must be given in a object:
```javascript
DM.loadDataFromUrls({name1: url1, name2: url2});
``` 
Returns a promise object with a list of the loaded data as parameter, e.g.:
```javascript
[{name:name1,data:data1},{name:name2,data:data2}]
``` 

JSON and CSV files will be automatically parsed. Other formats will simply be read as a regular string.

#### `DataManager.processData(dataArray)`

Gets a setof data in the format `[{name,data}]` (i.e. generated by `.loadDataFromUrls`) and attaches the data to the data manager. For example:
```javascript
DM.processData([{name:name1,data:data1},{name:name2,data:data2}]);
``` 
Will be attached to `DM` like so:
```javascript
DM.data.name1 // -> data1
DM.data.name2 // -> data2
```

#### `DataManager.loadAndProcessDataFromUrls(urls)`

Combines `.loadDataFromUrls` and `.processData` together. Takes a set of urls as input, attaches the data to the data manager instance, and returns a promise object (with no parameters):
```javascript
DM.loadAndProcessDataFromUrls({name1: url1, name2: url2}).then(()=>{
    console.log(DM.data.name1); // -> data1
    console.log(DM.data.name2); // -> data2
});
```

#### Important Notes

While any url and data name can be passed to `.loadAndProcessDataFromUrls`, other features of the data manager expect specific names and data structures:
- `mainMap` (and `subMaps`): the main map (and set of sub maps) JSON file(s) generated by the Topic Mapping Pipeline's mapping modules;
- `mainModel` (and `subModel`): the main model (and sub model) JSON file(s) generated by the Topic Mapping Pipeline's export model module;
- `distribution`: any distribution JSON file generated by the Topic Mapping Pipeline's topic distribution module (only one non-date `distribution` is supported);
- `trend`: a date distribution JSON file generated by the Topic Mapping Pipeline's topic distribution module;
- `labelsIndex`: the labels index JSON file generated by the Topic Mapping Pipeline's label indexing module.

These features provide shortcut to accessing and processing the data files to fit with the page's modules.

### Map features

These features let you access and interact with the data from `mainMap` and `subMaps`.

#### `DataManager.setSubMap(topicId)`

Given a the id of a topic from the main map, gets the sub map data attached to it and saves it to the `subMap` data attribute of the manager (for later access). Will throw and error if `subMaps` was not loaded or if no sub map can be found with this main topic id.
```javascript
DM.setSubMap('2');
console.log(DM.data.subMap); // -> sub map data assigned to main topic with id '2'
```

#### `DataManager.getSubMap([topicId])`

Same as `.setSubMap` but also returns the sub map data. `topicId` is optional here. If unspecified, the function will return the sub map data previously saved. If no sub map was previously set and no topic id is provided, the function will throw an error. The function can also throw errors from `.setSubMap` by proxy.
```javascript
let map = DM.getSubMap('2');
console.log(map); // -> sub map data assigned to main topic with id '2'

DM.setSubMap('5');
let map = DM.getSubMap();
console.log(map); // -> sub map data assigned to main topic with id '5'
```

#### `DataManager.getTopicMainMap(topicId)`

Returns the data (labels, position, etc.) for the topic with id `topicId` from the main map. Will throw an error if `mainMap` was not loaded or if no topic can be found with the specified id.
```javascript
let t = DM.getTopicMainMap('3');
console.log(t); // -> topic data for topic with id '3' in main map
```

#### `DataManager.getTopicSubMap(topicId)`

Returns the data (labels, position, etc.) for the topic with id `topicId` from the sub map previously saved with `setSubMap`. Will throw an error if no sub map was previously set or if no topic can be found with the specified id.
```javascript
let t = DM.getTopicSubMap('1');
console.log(t); // -> topic data for topic with id '1' in sub map
```

### Document List features

These features let you access and interact with the document lists inside the `mainModel` and `subModel`.

#### `DataManager.setTableRowsMainTopic(topicId)`

Given a topic id from the main model, will set the data attribute `tableRows` to the topic's top documents. If no topic is found `tableRows` is set to an empty list. If `mainModel` was not loaded, the function will throw an error.
```javascript
DM.setTableRowsMainTopic('4');
console.log(DM.data.tableRows); // -> the list of top documents for topic '4' in the main model
``` 

#### `DataManager.setTableRowsMainTopic(topicId)`

Same as above but with topics from the sub model.
```javascript
DM.setTableRowsSubTopic('6');
console.log(DM.data.tableRows); // -> the list of top documents for topic '6' in the sub model
``` 

#### `DataManager.getTableRows([number [, filter]])`

Returns the list of documents saved in `tableRows` with the methods above. `number` is optional and lets you crop the list to the top x document entries, its default value is `10`. `filter` is optional too and lets you provide a function to filter the documents (before croping the list), its default value is `()=>true` (no filter). The function will throw an error if `tableRows` has not been set.
```javascript
DM.setTableRowsMainTopic('4');
let d = DM.getTableRows(30, d=>d.published);
console.log(d); // -> list of the top 30 documents, that were "published", from topic '4' in the main model 
```

#### `DataManager.getDocument(docId)`

Given a document id, returns the associated document data saved in `tableRows`. The function will throw an error if `tableRows` has not been set or is empty, or if no document with such id can be found. 
```javascript
DM.setTableRowsMainTopic('4');
let d = DM.getDocument('43');
console.log(d); // -> data for the document '43', which is in the top documents for topic '4' in the main model.
```

### Distribution features

### Trend features

### Search features

## Styles


---

[![CC BY-NC 4.0][cc-by-nc-shield]][cc-by-nc]

This work is licensed under a [Creative Commons Attribution 4.0 International
License][cc-by-nc].

[![CC BY-NC 4.0][cc-by-nc-image]][cc-by-nc]

[cc-by-nc]: http://creativecommons.org/licenses/by-nc/4.0/
[cc-by-nc-image]: https://i.creativecommons.org/l/by-nc/4.0/88x31.png
[cc-by-nc-shield]: https://img.shields.io/badge/License-CC%20BY--NC%204.0-lightgrey.svg
